<!-- 显示错误/成功提示 -->
<% flash.each do |key, value| %>
  <div class="alert alert-<%= key %> alert-dismissible fade show">
    <%= value %>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
<% end %>

<!-- 搜索表单：提交到search_tmdb动作，使用GET请求 -->
<h2>Search in TMDb</h2>
<%= form_tag search_tmdb_path, method: :get, id: "tmdb_form" do %>
  <div class="mb-3">
    <!-- 电影标题输入框：ID为movie_title_field，name保持原来的search_terms（后端依赖的参数名） -->
    <label for="movie_title_field" class="form-label">Movie Name</label>
    <%= text_field_tag :search_terms, params[:search_terms], 
      id: "movie_title_field",  # 满足测试的ID要求
      class: "form-control"     # 不修改name，保持与后端一致（默认name为search_terms）
    %>
  </div>
  <div class="mb-3">
    <!-- 电影年份输入框：ID为movie_year_field，name保持原来的release_year（后端依赖的参数名） -->
    <label for="movie_year_field" class="form-label">Release Date</label>
    <%= text_field_tag :release_year, params[:release_year], 
      id: "movie_year_field",  # 满足测试的ID要求
      class: "form-control"    # 不修改name，保持与后端一致（默认name为release_year）
    %>
  </div>
  <div class="mb-3">
    <label class="form-label">Language</label>
    <%= radio_button_tag :language, "en", true, id: "en_lang" %>
    <%= label_tag :en_lang, "English Only" %>
    <%= radio_button_tag :language, "all", false, id: "all_lang" %>
    <%= label_tag :all_lang, "All Languages" %>
  </div>
  <!-- 搜索提交按钮：ID为tmdb_submit -->
  <%= submit_tag "Search", 
    class: "btn btn-primary", 
    id: "tmdb_submit"  # 满足测试的ID要求
  %>
  <!-- 返回主页按钮 -->
  <%= link_to "Back to movie list", movies_path, class: "btn btn-secondary ms-2" %>
<% end %>

<!-- 搜索结果表格（不变） -->
<% if @movies.present? %>
  <h3 class="mt-4">Search Results</h3>
  <table id="search_movies" class="table table-striped">
    <thead>
      <tr>
        <th>Title</th>
        <th>Release Date</th>
        <th>Language</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <% @movies.each do |movie| %>
        <tr>
          <td><%= movie[:title] %></td>
          <td><%= movie[:release_date] %></td>
          <td><%= movie[:language] %></td>
          <td>
            <%= form_tag add_movie_path, method: :post do %>
              <%= hidden_field_tag :title, movie[:title] %>
              <%= hidden_field_tag :release_date, movie[:release_date] %>
              <%= hidden_field_tag :language, movie[:language] %>
              <%= hidden_field_tag :rating, "R" %>
              <%= submit_tag "Add to RottenPotatoes", class: "btn btn-sm btn-success" %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <!-- 无结果/空提交提示（不变） -->
  <% if params[:search_terms].present? || params[:release_year].present? %>
    <div class="alert alert-warning mt-4">
      No movies matched your search criteria.
    </div>
  <% end %>
  <% if flash[:alert].blank? && (params[:commit] == "Search" && params[:search_terms].blank? && params[:release_year].blank?) %>
    <div class="alert alert-danger mt-4">
      Please enter at least a movie title or release year.
    </div>
  <% end %>
<% end %>

<% flash.each do |key, value| %>
  <div class="alert alert-<%= key %> alert-dismissible fade show" role="alert">
    <%= value %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% end %>